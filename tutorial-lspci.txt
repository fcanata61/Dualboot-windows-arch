###############################################################################
# Gentoo Notebook - Configuração de Hardware com lspci
# Autor: Gerado por ChatGPT
# Objetivo: Identificar dispositivos PCI, drivers e firmware para Gentoo
###############################################################################

#############################
# 1. Listar todos os dispositivos PCI
#############################
# Mostra todos os dispositivos com IDs e detalhes
lspci -vnn

# Mostra também o driver em uso e módulos disponíveis
lspci -nnk

# Exemplo de saída:
# 00:1f.3 Audio device [0403]: Intel Corporation Sunrise Point-LP HD Audio [8086:9d70]
#  Kernel driver in use: snd_hda_intel
#  Kernel modules: snd_hda_intel
# 00:14.3 Network controller [0280]: Intel Corporation Wireless 8265 / 8275 [8086:24fd]
#  Kernel driver in use: iwlwifi
#  Kernel modules: iwlwifi
# 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM108M [GeForce 940MX]
#  Kernel driver in use: nouveau
#  Kernel modules: nouveau

#############################
# 2. Identificar dispositivos críticos
#############################
# Rede: Ethernet e Wi-Fi
# Áudio: Intel HDA ou Realtek
# Vídeo: Intel iGPU ou NVIDIA/AMD GPU
# Armazenamento: SATA, NVMe
# Bluetooth: integrado na placa Wi-Fi
# Outros: touchpad, webcam, leitor de cartão SD

#############################
# 3. Identificar drivers do kernel necessários
#############################
# Analise a coluna "Kernel modules" do lspci -nnk
# Ou use a tabela PCI IDs no Gentoo Wiki ou: https://wiki.gentoo.org/wiki/Hardware_compatibility

# Exemplo de drivers:
# - snd_hda_intel → áudio Intel HDA
# - iwlwifi → Intel Wi-Fi
# - e1000/e1000e → Intel Ethernet
# - nouveau → GPU NVIDIA open-source
# - amdgpu → GPU AMD
# - ahci → SATA/AHCI
# - nvme → NVMe SSD

#############################
# 4. Configurar kernel
#############################
cd /usr/src/linux
sudo make menuconfig

# Habilitar módulos detectados no lspci:
# Audio: Device Drivers → Sound card → Intel HDA → snd_hda_intel
# Wi-Fi: Device Drivers → Network device support → Wireless → Intel → iwlwifi
# Ethernet: Device Drivers → Network device support → Ethernet → Intel e1000/e1000e
# GPU: Device Drivers → Graphics support → Intel/Nouveau/AMDGPU
# Storage: Device Drivers → Serial ATA and Parallel ATA → AHCI/NVMe
# Bluetooth: Device Drivers → Bluetooth → Intel/Realtek
# Outros: Touchpad (Elantech, Synaptics), webcam (USB webcams)

# Desabilite drivers que você não possui para reduzir tamanho e melhorar desempenho.

#############################
# 5. Compilar e instalar kernel
#############################
sudo make -j$(nproc)
sudo make modules_install
sudo make install

# Atualizar GRUB
sudo grub-mkconfig -o /boot/grub/grub.cfg

# Reiniciar e testar
sudo reboot
uname -r

#############################
# 6. Instalar firmware adicional
#############################
sudo emerge sys-kernel/linux-firmware

# Firmware específico:
# Intel Wi-Fi: incluído no linux-firmware
# NVIDIA/AMD GPU: driver open-source usa firmware do linux-firmware
# Realtek: geralmente linux-firmware também cobre

#############################
# 7. Verificar dispositivos após boot
#############################
# Áudio:
aplay -l
alsamixer

# Rede:
ip link
iwconfig

# GPU (para Xorg):
glxinfo | grep OpenGL

# Bluetooth:
bluetoothctl list

# Touchpad:
xinput list

#############################
# 8. Dicas finais
#############################
# - Para desktops, habilite somente módulos essenciais de áudio, vídeo e rede
# - Para servidores, habilite apenas disco, rede e CPU
# - Use USE flags enxutas em make.conf para reduzir recompilações
# - Consulte Gentoo Wiki Hardware Compatibility: https://wiki.gentoo.org/wiki/Hardware_compatibility
# - Para módulos que não funcionarem, verifique firmware e drivers no Portage

###############################################################################
# Fim do Guia de Configuração de Hardware Gentoo usando lspci
###############################################################################
